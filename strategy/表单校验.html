<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>表单校验</title>
</head>
<body>
    <form action="" id="registerForm">
        用户名<input type="text" name="username">
        密码<input type="text" name="password">
        手机号<input type="text" name="phoneNumber">

        <button>提交</button>
    </form>
    <script>

        var registerForm  = document.getElementById('registerForm')
        // registerForm.onsubmit = function(){
        //     if(registerForm.username.value === ''){
        //         alert('用户名不能为空')
        //         return false
        //     }
        //     if(registerForm.password.value === ''){
        //         alert('密码长度不超过6位')
        //         return false
        //     }
        //     if(!/(^1[3|5|8][0-9]{9}$)/.test(registerForm.phoneNumber.value)){
        //         alert('手机号格式不正确')
        //         return false
        //     }
        // }

        var strategies = {
            isNotEmpty: function(value,errorMsg){
                if(value === ''){
                    return errorMsg
                }
            },
            minLength: function(value,length,errorMsg){
                if(value.length < length){
                    return errorMsg
                }
            },
            isPhone: function(value,errorMsg){
                if(!/(^1[3|5|8][0-9]{9}$)/.test(value)){
                    return errorMsg
                }
            }
        }

        var validateFunc = function(){
            var validator = new Validator()

            validator.add(registerForm.username,'isNotEmpty','用户名不能位空')
            // validator.add(registerForm.username,[
            //     {
            //         strategy:'isNotEmpty',
            //         errorMsg: '用户名不能为空'
            //     },
            //     {
            //         strategy: 'minLength:10',
            //         errorMsg: '用户名长度不能小于10'
            //     }
            // ])
            validator.add(registerForm.password,'minLength:6','密码长度不能少于6位')
            validator.add(registerForm.username,'isPhone','手机号格式不正确')


            var errorMsg = validator.start()
            // strategies.isNotEmpty(registerForm.username.value,'用户名不能位空')
            return errorMsg
        }
        registerForm.onsubmit = function(){
            var errorMsg = validateFunc()
            if(errorMsg){
                alert(errorMsg)
                return false
            }
        }

        function Validator(){
            this.cache = []
        }

        Validator.prototype.add = function(dom,rule,errorMsg){
            var arr = rule.split(':')
            this.cache.push(function(){
                var strategy = arr.shift()
                arr.unshift(dom.value)
                arr.push(errorMsg)
                return strategies[strategy].apply(dom,arr)
            })
        }


        Validator.prototype.start = function(){
            for(let i = 0; i < this.cache.length; i++){
                var msg = this.cache[i]()
                if(msg){
                    return msg
                }
            }
        }
    </script>
</body>
</html>